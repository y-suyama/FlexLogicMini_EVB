import machine
import time

# *************** 温度センサ電圧***********************
# 対応電圧の線形補間関数
# 冷接点補償用温度センサの値を熱電対電圧に変換
def linear_interpolation_t_to_v(temperature):
    # K型熱電対の温度-電圧テーブル
    temp_voltage_table = {
    -50:-1.0,
    -48:-0.96,
    -46:-0.92,
    -44:-0.88,
    -42:-0.84,
    -40:-0.8,
    -38:-0.76,
    -36:-0.72,
    -34:-0.68,
    -32:-0.64,
    -30:-0.6,
    -28:-0.56,
    -26:-0.52,
    -24:-0.48,
    -22:-0.44,
    -20:-0.4,
    -18:-0.36,
    -16:-0.32,
    -14:-0.28,
    -12:-0.24,
    -10:-0.2,
    -8:-0.16,
    -6:-0.12,
    -4:-0.08,
    -2:-0.04,
    0:0.0,
    2:0.08,
    4:0.16,
    6:0.24,
    8:0.32,
    10:0.4,
    12:0.48,
    14:0.56,
    16:0.64,
    18:0.72,
    20:0.8,
    22:0.88,
    24:0.96,
    26:1.04,
    28:1.12,
    30:1.2,
    32:1.28,
    34:1.36,
    36:1.44,
    38:1.52,
    40:1.6,
    42:1.68,
    44:1.76,
    46:1.84,
    48:1.92,
    50:2.0,
    52:2.08,
    54:2.16,
    56:2.24,
    58:2.32,
    60:2.4,
    62:2.48,
    64:2.56,
    66:2.64,
    68:2.72,
    70:2.8,
    72:2.88,
    74:2.96,
    76:3.04,
    78:3.12,
    80:3.2,
    82:3.28,
    84:3.36,
    86:3.44,
    88:3.52,
    90:3.6,
    92:3.68,
    94:3.76,
    96:3.84,
    98:3.92,
    100:4.0,
    102:4.08,
    104:4.16,
    106:4.24,
    108:4.32,
    110:4.4,
    112:4.48,
    114:4.56,
    116:4.64,
    118:4.72,
    120:4.8,
    122:4.88,
    124:4.96,
    126:5.04,
    128:5.12,
    130:5.2,
    132:5.28,
    134:5.36,
    136:5.44,
    138:5.52,
    140:5.6,
    142:5.68,
    144:5.76,
    146:5.84,
    148:5.92,
    150:6.0,
    152:6.08,
    154:6.16,
    156:6.24,
    158:6.32,
    160:6.4,
    162:6.48,
    164:6.56,
    166:6.64,
    168:6.72,
    170:6.8,
    172:6.88,
    174:6.96,
    176:7.04,
    178:7.12,
    180:7.2,
    182:7.28,
    184:7.36,
    186:7.44,
    188:7.52,
    190:7.6,
    192:7.68,
    194:7.76,
    196:7.84,
    198:7.92,
    200:8.0,
    202: 8.08,
    204: 8.16,
    206: 8.24,
    208: 8.32,
    210: 8.40,
    212: 8.48,
    214: 8.56,
    216: 8.64,
    218: 8.72,
    220: 8.80,
    222: 8.88,
    224: 8.96,
    226: 9.04,
    228: 9.12,
    230: 9.20,
    232: 9.28,
    234: 9.36,
    236: 9.44,
    238: 9.52,
    240: 9.60,
    242: 9.68,
    244: 9.76,
    246: 9.84,
    248: 9.92,
    250: 10.00,
    252: 10.08,
    254: 10.16,
    256: 10.24,
    258: 10.32,
    260: 10.40,
    262: 10.48,
    264: 10.56,
    266: 10.64,
    268: 10.72,
    270: 10.80,
    272: 10.88,
    274: 10.96,
    276: 11.04,
    278: 11.12,
    280: 11.20,
    282: 11.28,
    284: 11.36,
    286: 11.44,
    288: 11.52,
    290: 11.60,
    292: 11.68,
    294: 11.76,
    296: 11.84,
    298: 11.92,
    300: 12.00,
    302: 12.08,
    304: 12.16,
    306: 12.24,
    308: 12.32,
    310: 12.40,
    312: 12.48,
    314: 12.56,
    316: 12.64,
    318: 12.72,
    320: 12.80,
    322: 12.88,
    324: 12.96,
    326: 13.04,
    328: 13.12,
    330: 13.20,
    332: 13.28,
    334: 13.36,
    336: 13.44,
    338: 13.52,
    340: 13.60,
    342: 13.68,
    344: 13.76,
    346: 13.84,
    348: 13.92,
    350: 14.00,
    352: 14.08,
    354: 14.16,
    356: 14.24,
    358: 14.32,
    360: 14.40,
    362: 14.48,
    364: 14.56,
    366: 14.64,
    368: 14.72,
    370: 14.80,
    372: 14.88,
    374: 14.96,
    376: 15.04,
    378: 15.12,
    380: 15.20,
    382: 15.28,
    384: 15.36,
    386: 15.44,
    388: 15.52,
    390: 15.60,
    392: 15.68,
    394: 15.76,
    396: 15.84,
    398: 15.92,
    400: 16.00,
    402: 16.08,
    404: 16.16,
    406: 16.24,
    408: 16.32,
    410: 16.40,
    412: 16.48,
    414: 16.56,
    416: 16.64,
    418: 16.72,
    420: 16.80,
    422: 16.88,
    424: 16.96,
    426: 17.04,
    428: 17.12,
    430: 17.20,
    432: 17.28,
    434: 17.36,
    436: 17.44,
    438: 17.52,
    440: 17.60,
    442: 17.68,
    444: 17.76,
    446: 17.84,
    448: 17.92,
    450: 18.00,
    452: 18.08,
    454: 18.16,
    456: 18.24,
    458: 18.32,
    460: 18.40,
    462: 18.48,
    464: 18.56,
    466: 18.64,
    468: 18.72,
    470: 18.80,
    472: 18.88,
    474: 18.96,
    476: 19.04,
    478: 19.12,
    480: 19.20,
    482: 19.28,
    484: 19.36,
    486: 19.44,
    488: 19.52,
    490: 19.60,
    492: 19.68,
    494: 19.76,
    496: 19.84,
    498: 19.92,
    500: 20.00
    }
    keys = list(temp_voltage_table.keys())
    values = list(temp_voltage_table.values())

    try:
        idx = next(i for i, temp in enumerate(keys) if temp > temperature) - 1
    except StopIteration:
        idx = len(keys) - 2 # デフォルトで最後のペアを使用

    temp1, temp2 = keys[idx], keys[idx+1]
    volt1, volt2 = values[idx], values[idx+1]

    return volt1 + (temperature - temp1) * (volt2 - volt1) / (temp2 - temp1)

# *************** 熱電対温度***********************
# 対応温度の線形補間関数
def linear_interpolation_v_to_t(voltage):
    # K型熱電対の電圧-温度テーブル
    temp_voltage_table = {
    -50:-1.0,
    -48:-0.96,
    -46:-0.92,
    -44:-0.88,
    -42:-0.84,
    -40:-0.8,
    -38:-0.76,
    -36:-0.72,
    -34:-0.68,
    -32:-0.64,
    -30:-0.6,
    -28:-0.56,
    -26:-0.52,
    -24:-0.48,
    -22:-0.44,
    -20:-0.4,
    -18:-0.36,
    -16:-0.32,
    -14:-0.28,
    -12:-0.24,
    -10:-0.2,
    -8:-0.16,
    -6:-0.12,
    -4:-0.08,
    -2:-0.04,
    0:0.0,
    2:0.08,
    4:0.16,
    6:0.24,
    8:0.32,
    10:0.4,
    12:0.48,
    14:0.56,
    16:0.64,
    18:0.72,
    20:0.8,
    22:0.88,
    24:0.96,
    26:1.04,
    28:1.12,
    30:1.2,
    32:1.28,
    34:1.36,
    36:1.44,
    38:1.52,
    40:1.6,
    42:1.68,
    44:1.76,
    46:1.84,
    48:1.92,
    50:2.0,
    52:2.08,
    54:2.16,
    56:2.24,
    58:2.32,
    60:2.4,
    62:2.48,
    64:2.56,
    66:2.64,
    68:2.72,
    70:2.8,
    72:2.88,
    74:2.96,
    76:3.04,
    78:3.12,
    80:3.2,
    82:3.28,
    84:3.36,
    86:3.44,
    88:3.52,
    90:3.6,
    92:3.68,
    94:3.76,
    96:3.84,
    98:3.92,
    100:4.0,
    102:4.08,
    104:4.16,
    106:4.24,
    108:4.32,
    110:4.4,
    112:4.48,
    114:4.56,
    116:4.64,
    118:4.72,
    120:4.8,
    122:4.88,
    124:4.96,
    126:5.04,
    128:5.12,
    130:5.2,
    132:5.28,
    134:5.36,
    136:5.44,
    138:5.52,
    140:5.6,
    142:5.68,
    144:5.76,
    146:5.84,
    148:5.92,
    150:6.0,
    152:6.08,
    154:6.16,
    156:6.24,
    158:6.32,
    160:6.4,
    162:6.48,
    164:6.56,
    166:6.64,
    168:6.72,
    170:6.8,
    172:6.88,
    174:6.96,
    176:7.04,
    178:7.12,
    180:7.2,
    182:7.28,
    184:7.36,
    186:7.44,
    188:7.52,
    190:7.6,
    192:7.68,
    194:7.76,
    196:7.84,
    198:7.92,
    200:8.0,
    202: 8.08,
    204: 8.16,
    206: 8.24,
    208: 8.32,
    210: 8.40,
    212: 8.48,
    214: 8.56,
    216: 8.64,
    218: 8.72,
    220: 8.80,
    222: 8.88,
    224: 8.96,
    226: 9.04,
    228: 9.12,
    230: 9.20,
    232: 9.28,
    234: 9.36,
    236: 9.44,
    238: 9.52,
    240: 9.60,
    242: 9.68,
    244: 9.76,
    246: 9.84,
    248: 9.92,
    250: 10.00,
    252: 10.08,
    254: 10.16,
    256: 10.24,
    258: 10.32,
    260: 10.40,
    262: 10.48,
    264: 10.56,
    266: 10.64,
    268: 10.72,
    270: 10.80,
    272: 10.88,
    274: 10.96,
    276: 11.04,
    278: 11.12,
    280: 11.20,
    282: 11.28,
    284: 11.36,
    286: 11.44,
    288: 11.52,
    290: 11.60,
    292: 11.68,
    294: 11.76,
    296: 11.84,
    298: 11.92,
    300: 12.00,
    302: 12.08,
    304: 12.16,
    306: 12.24,
    308: 12.32,
    310: 12.40,
    312: 12.48,
    314: 12.56,
    316: 12.64,
    318: 12.72,
    320: 12.80,
    322: 12.88,
    324: 12.96,
    326: 13.04,
    328: 13.12,
    330: 13.20,
    332: 13.28,
    334: 13.36,
    336: 13.44,
    338: 13.52,
    340: 13.60,
    342: 13.68,
    344: 13.76,
    346: 13.84,
    348: 13.92,
    350: 14.00,
    352: 14.08,
    354: 14.16,
    356: 14.24,
    358: 14.32,
    360: 14.40,
    362: 14.48,
    364: 14.56,
    366: 14.64,
    368: 14.72,
    370: 14.80,
    372: 14.88,
    374: 14.96,
    376: 15.04,
    378: 15.12,
    380: 15.20,
    382: 15.28,
    384: 15.36,
    386: 15.44,
    388: 15.52,
    390: 15.60,
    392: 15.68,
    394: 15.76,
    396: 15.84,
    398: 15.92,
    400: 16.00,
    402: 16.08,
    404: 16.16,
    406: 16.24,
    408: 16.32,
    410: 16.40,
    412: 16.48,
    414: 16.56,
    416: 16.64,
    418: 16.72,
    420: 16.80,
    422: 16.88,
    424: 16.96,
    426: 17.04,
    428: 17.12,
    430: 17.20,
    432: 17.28,
    434: 17.36,
    436: 17.44,
    438: 17.52,
    440: 17.60,
    442: 17.68,
    444: 17.76,
    446: 17.84,
    448: 17.92,
    450: 18.00,
    452: 18.08,
    454: 18.16,
    456: 18.24,
    458: 18.32,
    460: 18.40,
    462: 18.48,
    464: 18.56,
    466: 18.64,
    468: 18.72,
    470: 18.80,
    472: 18.88,
    474: 18.96,
    476: 19.04,
    478: 19.12,
    480: 19.20,
    482: 19.28,
    484: 19.36,
    486: 19.44,
    488: 19.52,
    490: 19.60,
    492: 19.68,
    494: 19.76,
    496: 19.84,
    498: 19.92,
    500: 20.00
    }
    keys = list(temp_voltage_table.keys())
    values = list(temp_voltage_table.values())

    try:
        idx = next(i for i, v in enumerate(values) if v > voltage) - 1
    except StopIteration:
        idx = len(values) - 2 # デフォルトで最後のペアを使用
    temp1, temp2 = keys[idx], keys[idx+1]
    volt1, volt2 = values[idx], values[idx+1]

    return temp1 + (voltage - volt1) * (temp2 - temp1) / (volt2 - volt1)


